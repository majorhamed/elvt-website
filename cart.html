<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cart | ELVT.</title>
<style>
/* Minimal styles for brevity, keep your existing styles */
body { background:#0a0a0a; color:#f5f5f5; font-family:'Poppins', sans-serif; }
.cart-container { max-width:900px; margin:120px auto 60px auto; }
.cart-item { display:flex; gap:20px; margin-bottom:20px; }
.cart-item img { width:90px; border-radius:8px; }
.remove-btn { background:#b00000; color:#fff; border:none; padding:6px 12px; cursor:pointer; }
.total { text-align:right; font-size:22px; margin-top:20px; }
#order-form { display:flex; flex-direction:column; gap:10px; max-width:400px; margin:20px auto; }
#order-form input, #order-form textarea { padding:8px; background:#1a1a1a; color:#fff; border:1px solid #333; border-radius:5px; }
#order-form button { padding:12px; background:#ff6347; color:#fff; border:none; cursor:pointer; font-weight:500; }
.success-message { display:none; color:#ff6347; text-align:center; margin-top:10px; }
.success-message.show { display:block; }
</style>
</head>
<body>

<div class="cart-container">
  <h1>Your Cart</h1>
  <div id="cart-items"></div>
  <div class="total" id="cart-total"></div>

  <!-- Order Form (Formspree) -->
  <form id="order-form" action="https://formspree.io/f/xzzyzval" method="POST">
      <input type="text" name="name" placeholder="Your Name" required>
      <input type="tel" name="phone" placeholder="Your Phone Number" required>
      <input type="email" name="email" placeholder="Your Email (optional)">
      <input type="text" name="address" placeholder="Street Address" required>
      <input type="text" name="city" placeholder="City" required>
      <input type="text" name="zip" placeholder="ZIP / Postal Code" required>
      <input type="text" name="country" placeholder="Country" required>
      <textarea name="notes" placeholder="Additional notes or instructions"></textarea>
      <input type="hidden" name="_subject" value="New ELVT Order">
      <input type="hidden" name="_replyto" value="elvtbyadam@outlook.com">
      <input type="hidden" name="cartDetails" id="cartDetails">
      <button type="submit">Place Order / Checkout</button>
  </form>

  <p id="order-success" class="success-message">Your order was sent successfully!</p>
</div>

<script>
// --- Cart rendering ---
let cart = JSON.parse(localStorage.getItem('cart')) || [];
const cartItems = document.getElementById('cart-items');
const cartTotal = document.getElementById('cart-total');
const orderForm = document.getElementById('order-form');
const cartDetailsInput = document.getElementById('cartDetails');

function renderCart() {
  cartItems.innerHTML = "";
  let total = 0;
  if(cart.length === 0){
    cartItems.innerHTML = "<p>Your cart is empty</p>";
    cartTotal.style.display = "none";
    orderForm.querySelector("button").style.display = "none";
    return;
  }
  cart.forEach((item,index) => {
    total += item.price * item.qty;
    cartItems.innerHTML += `
      <div class="cart-item">
        <img src="${item.image}" alt="${item.name}">
        <div>
          <h3>${item.name}</h3>
          <p>Size: ${item.size}</p>
          <p>Qty: ${item.qty}</p>
          <p>$${(item.price*item.qty).toFixed(2)}</p>
        </div>
        <button class="remove-btn" onclick="removeItem(${index})">Remove</button>
      </div>`;
  });
  cartTotal.style.display="block";
  cartTotal.innerHTML=`Total: $${total.toFixed(2)}`;
}
function removeItem(index){
  cart.splice(index,1);
  localStorage.setItem('cart',JSON.stringify(cart));
  renderCart();
}
renderCart();

// --- Form submit: Formspree + Stripe ---
orderForm.addEventListener('submit', async e => {
  e.preventDefault();
  if(cart.length===0){ alert('Cart empty'); return; }

  // Save cart to hidden field for Formspree
  cartDetailsInput.value = JSON.stringify(cart);

  try {
    const response = await fetch('/api/create-checkout-session',{
      method:'POST',
      headers:{ 'Content-Type':'application/json' },
      body: JSON.stringify({ cartItems: cart })
    });
    const data = await response.json();

    if(data.url){
      window.location.href = data.url; // Redirect to Stripe Checkout
    } else {
      alert(data.error || "Stripe checkout failed");
    }
  } catch(err){
    console.error(err);
    alert("Error connecting to Stripe");
  }
});
</script>

</body>
</html>
