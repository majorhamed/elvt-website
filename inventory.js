/* =================================================
   ELVT MANUAL INVENTORY SYSTEM
   Edit stock numbers below only
   ================================================= */
/* =================================================
   ELVT MANUAL INVENTORY SYSTEM
   Edit stock numbers only
   ================================================= */

const INVENTORY = {

  /* ===== JERSEYS ===== */
  "ELVT Retro Jersey Lebanon Beige": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Retro Jersey Lebanon White": { S: 3, M: 3, L: 2, XL: 0 },

  /* ===== SHORTS ===== */
  "ELVT Mesh Drawstring Shorts BLACK": { S: 5, M: 5, L: 5, XL: 5 },
  "ELVT Mesh Drawstring Shorts GRAY": { S: 5, M: 0, L: 3, XL: 1 },

  /* ===== T-SHIRTS ===== */
  "ELVT Contrast Piped Panel T-Shirt": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Mineral Wash Boxy Cotton T-Shirt ( WE DONT FOLLOW LEVELS WE CREATE THEM )": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Vintage Wash Boxy Distressed Hem T-Shirt ( HIGHER THAN BEFORE )": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Snow Wash Raw-Hem Boxy T-shirt": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Contrast Panel Cotton T-Shirt RED": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Contrast Panel Cotton T-Shirt NAVY BLUE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Contrast Panel Cotton T-Shirt GRAY COFFEE": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== HOODIES ===== */
  "ELVT Contrast-Stitched Boxy Fleece Hoodie": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Snow Wash Hand-Frayed Heavyweight Hoodie": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Snow Wash Fleece Oversize Hoodie ( WE DONT FOLLOW LEVELS WE CREATE THEM )": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Vintage Washed Frayed-Hem Hoodie": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Essential Heavyweight Hoodie BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Essential Heavyweight Hoodie DULL RED": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Essential Heavyweight Hoodie CAMEL": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== SWEATPANTS ===== */
  "ELVT Reflection Striped Straight-Leg Sweatpants BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Reflection Striped Straight-Leg Sweatpants DARK GRAY": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Essential Drawstring Jogged Sweatpants": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Contrast-Stitched Fleece Sweatpants ( BLACK )": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Contrast-Stitched Fleece Sweatpants ( GRAY )": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Vintage Washed Gradient Straight-Leg Sweatpants BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Vintage Washed Gradient Straight-Leg Sweatpants COFFEE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Vintage Washed Gradient Straight-Leg Sweatpants DARK GRAY": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== ACTIVEWEAR / PERFORMANCE ===== */
  "ELVT DRIFIT TEE BLUE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT DRIFIT TEE GREEN": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT DRIFIT TEE RED": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Soft Hooded Sports Jacket BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Soft Hooded Sports Jacket WHITE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Performance Short Sleeve T-Shirt BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Performance Short Sleeve T-Shirt WHITE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Performance Short Sleeve T-Shirt GRAY": { S: 0, M: 0, L: 0, XL: 0 },











  /* ===== WOMEN T-SHIRTS ===== */
  "ELVT Vintage Wash Drop Shoulder T-shirt": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Taped Cooling Performance Crop Top": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Snow Washed Tank Top BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Snow Washed Tank Top WHITE": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== CROPPED HOODIES / SWEATSHIRTS ===== */
  "ELVT Cropped Half-Zip Hoodie COFFEE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Cropped Half-Zip Hoodie APRICOT": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Cropped Half-Zip Hoodie COOL GRAY": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Cropped Half-Zip Sweatshirt BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Cropped Half-Zip Sweatshirt LIGHT GRAY": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Cropped Half-Zip Sweatshirt APRICOT": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Cropped Half-Zip Sweatshirt GRAY": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== CROP TOPS ===== */
  "ELVT Ruched Bodycon Crop Top BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Ruched Bodycon Crop Top BEIGE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Ruched Bodycon Crop Top BROWN": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== CROPPED HOODIES (ESSENTIAL) ===== */
  "ELVT Essential Cropped Hoodie": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Snow Washed Cropped Hoodie": { S: 0, M: 0, L: 0, XL: 0 },

  /* ===== JOGGERS ===== */
  "ELVT Jogger Pants COFFEE": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Jogger Pants APRICOT": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Essential Drawstring Straight-Leg Sweatpants BLACK": { S: 0, M: 0, L: 0, XL: 0 },
  "ELVT Essential Drawstring Straight-Leg Sweatpants DARK REDDISH PURPLE": { S: 0, M: 0, L: 0, XL: 0 }

};


/* ===== Helpers ===== */
function getTotalStock(productName){
  const sizes = INVENTORY[productName];
  if(!sizes) return 9999; // treat as available if not listed
  return Object.values(sizes).reduce((s,n)=>s+(Number(n)||0),0);
}

function applyInventoryToCard(card){
  const name = card.dataset.product;
  const sizes = INVENTORY[name];
  const sizeButtons = card.querySelectorAll(".size-options button");
  const label = card.querySelector(".stock-label");
  const addBtn = card.querySelector(".add-btn");

  // If product not tracked â†’ enable everything
  if(!sizes){
    if(label){
      label.textContent = "In Stock";
      label.className = "stock-label in";
    }
    sizeButtons.forEach(b=>{
      b.disabled=false;
      b.classList.remove("sold-out");
      b.textContent=b.dataset.size;
    });
    if(addBtn){
      addBtn.disabled=false;
      addBtn.textContent="Add to Cart";
      addBtn.style.opacity="1";
    }
    return;
  }

  const total = getTotalStock(name);

  // Stock label
  if(label){
    label.textContent = total>0 ? "In Stock" : "Out of Stock";
    label.className = "stock-label " + (total>0 ? "in":"out");
  }

  // Sizes
  sizeButtons.forEach(btn=>{
    const size = btn.dataset.size;
    const qty = Number(sizes[size] || 0);

    btn.disabled=false;
    btn.classList.remove("sold-out");
    btn.textContent=size;

    if(qty<=0){
      btn.disabled=true;
      btn.classList.add("sold-out");
      btn.textContent = `${size} (Sold Out)`;
      btn.classList.remove("active");

      if(card.dataset.size === size){
        delete card.dataset.size;
      }
    }
  });

  // Add button
  if(addBtn){
    if(total<=0){
      addBtn.disabled=true;
      addBtn.textContent="Out of Stock";
      addBtn.style.opacity="0.5";
      addBtn.style.cursor="not-allowed";
    }else{
      addBtn.disabled=false;
      addBtn.textContent="Add to Cart";
      addBtn.style.opacity="1";
      addBtn.style.cursor="pointer";
    }
  }
}

/* ===== Init ===== */
document.addEventListener("DOMContentLoaded",()=>{
  document.querySelectorAll(".shop-item").forEach(card=>{
    const nameEl = card.querySelector("p");
    if(!nameEl) return;

    const productName = nameEl.textContent.trim();
    card.dataset.product = productName;

    // Insert stock label after price
    const ps = card.querySelectorAll("p");
    if(ps.length>=2){
      const label=document.createElement("div");
      label.className="stock-label";
      ps[1].after(label);
    }

    // Size buttons
    card.querySelectorAll(".size-options button").forEach(btn=>{
      const size = btn.textContent.trim();
      btn.dataset.size=size;

      btn.addEventListener("click",()=>{
        if(btn.disabled) return;
        card.querySelectorAll(".size-options button").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        card.dataset.size=size;
      });
    });

    // Mark add button
    const addBtn = card.querySelector("button[onclick*='addToCart']");
    if(addBtn) addBtn.classList.add("add-btn");

    applyInventoryToCard(card);
  });
});

/* ===== Cart protection ===== */
window.addToCart = function(name, price, image, item){
  const size = item.dataset.size;
  if(!size){
    showToast("Please select a size");
    return;
  }

  if(INVENTORY[name] && (INVENTORY[name][size]||0)<=0){
    showToast("This size is sold out");
    applyInventoryToCard(item);
    return;
  }

  let cart = JSON.parse(localStorage.getItem("cart")) || [];
  const existing = cart.find(p=>p.name===name && p.size===size);
  if(existing) existing.qty+=1;
  else cart.push({name,price,image,size,qty:1});

  localStorage.setItem("cart",JSON.stringify(cart));
  showToast(`${name} (${size}) added to cart`);
};
